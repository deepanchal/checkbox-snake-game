var k=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var s=(n,e,t)=>(k(n,e,"read from private field"),t?t.call(n):e.get(n)),u=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},f=(n,e,t,r)=>(k(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};R();function C(n){const{boardRef:e,rows:t,cols:r}=n;e.style.display="grid",e.style.gridTemplateColumns=`repeat(${r}, 1fr)`,e.style.gridTemplateRows=`repeat(${t}, 1fr)`,e.style.gap="1rem",e.style.justifyContent="center",e.style.alignItems="center"}const g={HEAD:1,BODY:1,TAIL:1,EMPTY:0,FOOD:2};var h,O,m;class P{constructor(){u(this,h,void 0);u(this,O,"right");u(this,m,1);f(this,h,[[0,0],[1,0],[2,0],[3,0]])}get head(){return s(this,h)[0]}get tail(){return s(this,h)[s(this,h).length-1]}get body(){return s(this,h)}get bodyWithoutHead(){return s(this,h).slice(1)}get length(){return s(this,h).length}set direction(e){f(this,O,e)}grow(){const e=this.tail;s(this,h).push([e[0],e[1]])}move(){const e=this.head,t=[e[0],e[1]];({up:()=>t[0]-=s(this,m),down:()=>t[0]+=s(this,m),left:()=>t[1]-=s(this,m),right:()=>t[1]+=s(this,m)})[s(this,O)](),s(this,h).unshift(t),s(this,h).pop()}}h=new WeakMap,O=new WeakMap,m=new WeakMap;var p,E,b,w,c,y,B;class I{constructor(e){u(this,p,void 0);u(this,E,void 0);u(this,b,void 0);u(this,w,void 0);u(this,c,void 0);u(this,y,!1);u(this,B,200);const{boardRef:t,rows:r,cols:o}=e;f(this,E,t),f(this,b,r||10),f(this,w,o||10),f(this,p,this.getInitialBoard()),f(this,c,new P)}get board(){return s(this,p)}get boardRef(){return s(this,E)}getInitialBoard(){return Array.from({length:s(this,b)}).map(()=>Array.from({length:s(this,w)}).map(()=>g.EMPTY))}sleep(e){return new Promise(t=>setTimeout(t,e))}renderBoard(){const{boardRef:e,board:t}=this;t.forEach((r,o)=>{r.forEach((i,a)=>{const l=e.querySelector(`#cell-${o}${a}`),d=document.createElement("input");d.setAttribute("type","checkbox"),d.setAttribute("id",`cell-${o}${a}`),i===g.FOOD?d.classList.add("cell__food"):d.classList.add("cell__body"),d.checked=i===g.BODY||i===g.FOOD,d.classList.add("cell"),d.dataset.row=o.toString(),d.dataset.col=a.toString(),l?l.replaceWith(d):e.appendChild(d)})})}generateFood(){const{board:e}=this,t=e.reduce((a,l,d)=>(l.forEach((v,L)=>{v===g.EMPTY&&a.push([d,L])}),a),[]),r=Math.floor(Math.random()*t.length),[o,i]=t[r];e[o][i]=g.FOOD}checkGameOver(){const{head:e}=s(this,c),[t,r]=e,o=t<0||t>=s(this,b)||r<0||r>=s(this,w),i=s(this,c).bodyWithoutHead.some(([a,l])=>a===e[0]&&l===e[1]);o||i?f(this,y,!0):f(this,y,!1)}handleGesture(e,t){const[r,o]=e,[i,a]=t,l=o-r,d=a-i,v=Math.abs(l),L=Math.abs(d),S=v>L,Y=v<L,F=l<0,M=d<0;S?F?s(this,c).direction="left":s(this,c).direction="right":Y&&(M?s(this,c).direction="up":s(this,c).direction="down")}registerEvents(){document.addEventListener("keydown",e=>{const t=e.key;[[["w","ArrowUp"],()=>s(this,c).direction="up"],[["s","ArrowDown"],()=>s(this,c).direction="down"],[["a","ArrowLeft"],()=>s(this,c).direction="left"],[["d","ArrowRight"],()=>s(this,c).direction="right"]].forEach(([o,i])=>{o.includes(t)&&i()})})}registerTouchEvents(){let e=[0,0],t=[0,0];document.addEventListener("touchstart",r=>{e[0]=r.changedTouches[0].screenX,t[0]=r.changedTouches[0].screenY}),document.addEventListener("touchend",r=>{e[1]=r.changedTouches[0].screenX,t[1]=r.changedTouches[0].screenY,this.handleGesture(e,t)})}async start(){for(console.log("start"),this.renderBoard(),this.generateFood(),this.registerEvents(),this.registerTouchEvents();!s(this,y);)await this.sleep(s(this,B)),s(this,c).move(),s(this,p).forEach((e,t)=>{e.forEach((r,o)=>{const i=s(this,c).body.some(([l,d])=>l===t&&d===o),a=r===g.FOOD;s(this,p)[t][o]=i?g.BODY:a?g.FOOD:g.EMPTY,i&&a&&(s(this,c).grow(),this.generateFood())})}),this.renderBoard(),console.log("move",s(this,c).head),this.checkGameOver();console.log("this.gameOver",s(this,y))}}p=new WeakMap,E=new WeakMap,b=new WeakMap,w=new WeakMap,c=new WeakMap,y=new WeakMap,B=new WeakMap;const G=document.querySelector("#app"),A=10,D=10,T=document.createElement("div");T.classList.add("game-board");const $={boardRef:T,rows:A,cols:D};C($);G.appendChild(T);const H=new I({boardRef:T,rows:A,cols:D});(async()=>await H.start())();
